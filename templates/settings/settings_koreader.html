<!-- Koreader 同步设置 -->
<div id="koreaderSettings" class="tab-content page-transition">
    <h3>{{ _('KOReader Sync Settings') }}</h3>
    <div class="mcp-docs">
        <h4>{{ _('Step 1: Configure WebDAV Cloud Storage') }}</h4>
        <ol>
            <li>{{ _('In KOReader, go to `Cloud storage` -> `Add new cloud storage`.') }}</li>
            <li>{{ _('Select `WebDAV`.') }}</li>
            <li><strong>{{ _('Server address') }}</strong>: {{ _('Fill in the address below, and <strong>ensure the path ends with a `/`</strong>.') }}
                <p><code id="koreader-webdav-url" class="webdav-url" title="{{ _('Click to copy') }}"></code></p>
            </li>
            <li><strong>{{ _('Username') }}</strong>: <code>{{ g.user.username }}</code></li>
            <li><strong>{{ _('Password') }}</strong>: {{ _('Your Anx Calibre Manager login password.') }}</li>
            <li><strong>{{ _('Folder') }}</strong>: <code>/anx/data/file</code></li>
            <li>{{ _('Click `Connect` and save. You should now be able to see your Anx library in KOReader\'s file browser.') }}</li>
        </ol>

        <h4>{{ _('Step 2: Install and Configure the Sync Plugin') }}</h4>
        <ol>
            <li>
                <strong>{{ _('Download Plugin') }}</strong>: {{ _('Click the button below to download the plugin zip file.') }}
                <div style="margin-top: 1rem; margin-bottom: 1rem;">
                    <button id="download-koreader-plugin-btn" data-url="{{ url_for('calibre.download_koreader_plugin') }}" class="button-primary">{{ _('Download KOReader Plugin (.zip)') }}</button>
                </div>
            </li>
            <li><strong>{{ _('Install Plugin') }}</strong>: {{ _('Unzip the downloaded `.zip` file, and you will get a folder named `anx-calibre-manager-koreader-plugin.koplugin`. Copy this <strong>entire folder</strong> to the `koreader/plugins/` directory on your KOReader device.') }}</li>
            <li><strong>{{ _('Restart KOReader') }}</strong>: {{ _('Completely close and reopen the KOReader application to load the new plugin.') }}</li>
            <li><strong>{{ _('Configure Sync Server') }}</strong>:
                <ul>
                    <li><strong>{{ _('Important') }}</strong>: {{ _('First, please open and start reading a book via the WebDAV set up in the previous step. The plugin menu will <strong>only appear in the reading interface</strong>.') }}</li>
                    <li>{{ _('In the reading interface, go to `Tools (wrench icon)` -> `Next page` -> `More tools` -> `ANX Calibre Manager`.') }}</li>
                    <li>{{ _('Select `Custom sync server`.') }}</li>
                    <li><strong>{{ _('Custom sync server address') }}</strong>: <code>{{ request.host_url.rstrip('/') }}/koreader</code></li>
                    <li>{{ _('Return to the previous menu, select `Login`, and enter your Anx Calibre Manager username and password.') }}</li>
                </ul>
            </li>
        </ol>
        <p>{{ _('Once configured, the plugin will automatically or manually sync your reading progress and time. You can adjust settings like sync frequency in the plugin menu.') }}</p><br>
        <p><strong>({{ _('Note: Only supports epub book synchronization') }})</strong></p>
    </div>
</div>