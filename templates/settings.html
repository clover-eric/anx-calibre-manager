{% extends "base.html" %}

{% block title %}{{ _('Settings') }} - Anx Calibre Manager{% endblock %}

{% block head_extra %}
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="loading-overlay" id="settings-loading-overlay" style="display: flex;">
        <div class="spinner"></div>
    </div>
    <h2>{{ _('Settings') }}</h2>

    <div class="tabs">
        <div class="tab-link active" onclick="openTab(event, 'userSettings')">{{ _('User Settings') }}</div>
        <div class="tab-link" onclick="openTab(event, 'mcpSettings')">{{ _('MCP Settings') }}</div>
        <div class="tab-link" onclick="openTab(event, 'koreaderSettings')">{{ _('Koreader Sync Settings') }}</div>
        {% if g.user and g.user.role == 'admin' %}
        <div class="tab-link" onclick="openTab(event, 'globalSettings')">{{ _('Global Settings') }}</div>
        <div class="tab-link" onclick="openTab(event, 'userManagement')">{{ _('User Management') }}</div>
        <div class="tab-link" onclick="openTab(event, 'inviteCodeManagement')">{{ _('Invite Code Management') }}</div>
        <div class="tab-link" onclick="openTab(event, 'userActivities')">{{ _('User Activities') }}</div>
        {% endif %}
    </div>

    {% include 'settings/settings_user_settings.html' %}

    {% include 'settings/settings_mcp.html' %}

    {% include 'settings/settings_koreader.html' %}

    <!-- 全局设置 (仅限管理员) -->
    {% if g.user and g.user.role == 'admin' %}
    {% include 'settings/settings_global.html' %}
    <!-- 用户管理 (仅限管理员) -->
    {% include 'settings/settings_user_management.html' %}
    <!-- 邀请码管理 (仅限管理员) -->
    {% include 'settings/settings_invite_code.html' %}
    <!-- 用户活动管理 (仅限管理员) -->
    {% include 'settings/settings_user_activities.html' %}
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script id="is-admin-data" type="application/json">{{ (g.user.role == 'admin') | tojson | safe }}</script>
<script id="is-maintainer-data" type="application/json">{{ g.user.is_maintainer | tojson | safe }}</script>
<!-- Load modular settings scripts -->
<script src="{{ url_for('static', filename='js/settings/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings/tabs.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings/user_settings.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings/mcp.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings/global_settings.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings/user_management.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings/invite_codes.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings/service_profiles.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/settings/user_activities.js') }}?v={{ cache_buster }}"></script>
<script src="{{ url_for('static', filename='js/settings/main.js') }}"></script>
{% endblock %}